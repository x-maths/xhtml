# P5.js åŠ¨ç”»æ¸²æŸ“ç³»ç»Ÿ - å®ç°æ€»ç»“

## ğŸ¯ å®ç°ç›®æ ‡

å®Œå–„ p5.js åŠ¨ç”»æ¸²æŸ“ç³»ç»Ÿ,æ”¯æŒä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å’Œæ‰§è¡ŒåŠ¨ç”»ä»£ç ,å®ç°é…ç½®é©±åŠ¨çš„åŠ¨ç”»æ¸²æŸ“ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒç³»ç»Ÿå¢å¼º (`template.html`)

#### æ–°å¢åŠŸèƒ½:

- **é…ç½®æ˜ å°„ç³»ç»Ÿ**: åˆ›å»º `window.p5ConfigMap` ç”¨äºç®¡ç† p5 é…ç½®
- **å¤šç§ä»£ç åŠ è½½æ–¹å¼**:
  - å†…è”ä»£ç  (`code` å­—æ®µ)
  - å¤–éƒ¨ URL (`codeUrl` å­—æ®µ)
  - å…¨å±€å‡½æ•°å¼•ç”¨ (`sketchFunction` å­—æ®µ)
  - è‡ªåŠ¨æŸ¥æ‰¾ (é€šè¿‡ `id` ä»å…¨å±€ä½œç”¨åŸŸè·å–)

#### æ–°å¢å‡½æ•°:

- `initializeP5Sketches(sketches)` - åˆå§‹åŒ–æ‰€æœ‰ p5 åŠ¨ç”»
- `initializeSingleP5Sketch(sketch)` - åˆå§‹åŒ–å•ä¸ª p5 åŠ¨ç”»
- `createSketchFromCode(code, sketchId)` - ä»ä»£ç å­—ç¬¦ä¸²åˆ›å»º sketch å‡½æ•°
- `fetchSketchCode(url)` - ä» URL è·å– sketch ä»£ç 
- `findContainerIdForSketch(sketchId)` - æŸ¥æ‰¾ sketch å¯¹åº”çš„å®¹å™¨ ID

#### æ”¹è¿›çš„æ¸²æŸ“æµç¨‹:

```
1. renderP5() â†’ æ³¨å†Œé…ç½®åˆ° p5ConfigMap
2. initializePage() â†’ è°ƒç”¨ initializeP5Sketches()
3. å¯¹æ¯ä¸ª sketch:
   - åŠ è½½ä»£ç  (å†…è”/URL/å…¨å±€)
   - åˆ›å»º sketch å‡½æ•°
   - æŸ¥æ‰¾å®¹å™¨ ID
   - åˆ›å»º p5 å®ä¾‹
   - å­˜å‚¨å®ä¾‹å¼•ç”¨
```

### 2. é…ç½®æ–‡ä»¶ç¤ºä¾‹

#### `config-with-p5-enhanced.json` (å†…è”ä»£ç æ–¹å¼)

- å®Œæ•´çš„ä½™æ•°åŠ¨ç”»é…ç½®
- åŠ¨ç”»ä»£ç ç›´æ¥åµŒå…¥åœ¨ `code` å­—æ®µä¸­
- åŒ…å«å‚æ•°ä¼ é€’ç¤ºä¾‹ (`params`)
- æ¼”ç¤ºäº†å®Œæ•´çš„åŠ¨ç”»å®ç°

#### `config-external-sketch.json` (å¤–éƒ¨ URL æ–¹å¼)

- å¼•ç”¨å¤–éƒ¨ JavaScript æ–‡ä»¶
- é€šè¿‡ `codeUrl` å­—æ®µåŠ è½½ä»£ç 
- æ›´é€‚åˆå¤æ‚åŠ¨ç”»çš„ç»´æŠ¤

### 3. ç‹¬ç«‹åŠ¨ç”»æ–‡ä»¶

#### `sketches/remainder-sketch.js`

- å®Œæ•´çš„ä½™æ•°æ¼”ç¤ºåŠ¨ç”»å®ç°
- å¯è¢«å¤–éƒ¨é…ç½®å¼•ç”¨
- åŒ…å«è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
- å®ç°äº†:
  - å“åº”å¼ç”»å¸ƒè°ƒæ•´
  - å¹³æ»‘åŠ¨ç”»æ•ˆæœ
  - å‚æ•°åŒ–é…ç½®
  - åŠ¨ç”»çŠ¶æ€ç®¡ç†

### 4. æ–‡æ¡£ç³»ç»Ÿ

#### `README-p5-system.md` (å®Œæ•´æ–‡æ¡£)

- ç³»ç»Ÿæ¦‚è¿°å’Œé…ç½®ç»“æ„
- ä¸‰ç§ä»£ç åŠ è½½æ–¹å¼è¯¦è§£
- å®Œæ•´ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- è°ƒè¯•æŠ€å·§å’Œå¸¸è§é—®é¢˜
- æŠ€æœ¯å®ç°ç»†èŠ‚

#### `P5-QUICK-REFERENCE.md` (å¿«é€Ÿå‚è€ƒ)

- ä¸‰ç§é…ç½®æ–¹å¼å¯¹æ¯”
- Sketch ä»£ç æ¨¡æ¿
- å‚æ•°ä¼ é€’ç¤ºä¾‹
- å¸¸ç”¨ä»£ç ç‰‡æ®µ
- è°ƒè¯•æ¸…å•

#### `test-p5-system.html` (æµ‹è¯•é¡µé¢)

- å¯è§†åŒ–çš„æµ‹è¯•ç•Œé¢
- å¿«é€Ÿè®¿é—®å„ç§é…ç½®ç¤ºä¾‹
- æ–‡æ¡£é“¾æ¥é›†åˆ
- ä½¿ç”¨è¯´æ˜å’Œå¼€å‘æŒ‡å—

## ğŸ“‹ é…ç½®ç»“æ„è¯´æ˜

### åœ¨å†…å®¹ä¸­å£°æ˜åŠ¨ç”»ä½ç½®

```json
{
  "stages": [
    {
      "content": [
        {
          "type": "p5",
          "title": "å¯è§†åŒ–æ¼”ç¤º",
          "containerId": "remainder-demo",
          "caption": "10 Ã· 3 = 3 ... 1",
          "sketchId": "remainderSketch"
        }
      ]
    }
  ]
}
```

### å®šä¹‰åŠ¨ç”»å®ç°

```json
{
  "p5Sketches": [
    {
      "id": "remainderSketch",
      "description": "ä½™æ•°æ¼”ç¤ºåŠ¨ç”»",
      "containerId": "remainder-demo",
      "params": {
        "totalApples": 10,
        "totalKids": 3
      },
      "code": "..." // æˆ– "codeUrl": "..." æˆ– "sketchFunction": "..."
    }
  ]
}
```

## ğŸ”§ Sketch ä»£ç æ ¼å¼

æ‰€æœ‰ sketch ä»£ç å¿…é¡»éµå¾ªä»¥ä¸‹æ ¼å¼:

```javascript
(function (p, containerId, params) {
  // å‚æ•°:
  // - p: p5.js å®ä¾‹å¯¹è±¡
  // - containerId: å®¹å™¨ DOM ID
  // - params: é…ç½®ä¸­çš„å‚æ•°å¯¹è±¡

  p.setup = function () {
    const canvas = p.createCanvas(400, 300);
    canvas.parent(containerId);
  };

  p.draw = function () {
    p.background(220);
    // ç»˜åˆ¶é€»è¾‘...
  };

  // å¯é€‰: å“åº”å¼è°ƒæ•´
  p.windowResized = function () {
    const container = document.getElementById(containerId);
    if (container) {
      p.resizeCanvas(container.clientWidth, 300);
    }
  };
});
```

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### æ–¹å¼ 1: å†…è”ä»£ç 

```json
{
  "id": "mySketch",
  "code": "(function(p, containerId, params) { ... })",
  "params": { "speed": 1 }
}
```

### æ–¹å¼ 2: å¤–éƒ¨ URL

```json
{
  "id": "mySketch",
  "codeUrl": "./sketches/my-sketch.js",
  "params": { "speed": 1 }
}
```

### æ–¹å¼ 3: å…¨å±€å‡½æ•°

```json
{
  "id": "mySketch",
  "sketchFunction": "mySketch"
}
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
xhtml/
â”œâ”€â”€ template.html                    # ä¸»æ¨¡æ¿ (å·²å¢å¼º)
â”œâ”€â”€ config-with-p5.json              # åŸå§‹é…ç½®
â”œâ”€â”€ config-with-p5-enhanced.json     # å†…è”ä»£ç ç¤ºä¾‹ (æ–°)
â”œâ”€â”€ config-external-sketch.json      # å¤–éƒ¨ä»£ç ç¤ºä¾‹ (æ–°)
â”œâ”€â”€ test-p5-system.html              # æµ‹è¯•é¡µé¢ (æ–°)
â”œâ”€â”€ README-p5-system.md              # å®Œæ•´æ–‡æ¡£ (æ–°)
â”œâ”€â”€ P5-QUICK-REFERENCE.md            # å¿«é€Ÿå‚è€ƒ (æ–°)
â””â”€â”€ sketches/                        # åŠ¨ç”»ä»£ç ç›®å½• (æ–°)
    â””â”€â”€ remainder-sketch.js          # ä½™æ•°åŠ¨ç”»ç¤ºä¾‹ (æ–°)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•ç°æœ‰ç¤ºä¾‹

```bash
# æ–¹å¼ 1: ä½¿ç”¨æµ‹è¯•é¡µé¢
æ‰“å¼€: test-p5-system.html

# æ–¹å¼ 2: ç›´æ¥è®¿é—®é…ç½®
æ‰“å¼€: template.html?config=config-with-p5-enhanced.json
æ‰“å¼€: template.html?config=config-external-sketch.json
```

### 2. åˆ›å»ºæ–°åŠ¨ç”»

1. ç¼–å†™ sketch ä»£ç  (å‚è€ƒ `sketches/remainder-sketch.js`)
2. åˆ›å»ºé…ç½®æ–‡ä»¶ (å‚è€ƒ `config-with-p5-enhanced.json`)
3. åœ¨é…ç½®ä¸­æ·»åŠ  p5 å†…å®¹é¡¹å’Œ sketch å®šä¹‰
4. è®¿é—®: `template.html?config=ä½ çš„é…ç½®.json`

### 3. è°ƒè¯•åŠ¨ç”»

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­
window.p5ConfigMap; // æŸ¥çœ‹æ‰€æœ‰é…ç½®
window.p5_remainderSketch; // è®¿é—®ç‰¹å®š sketch å®ä¾‹
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… é…ç½®é©±åŠ¨

- æ‰€æœ‰åŠ¨ç”»é€šè¿‡ JSON é…ç½®å®šä¹‰
- æ”¯æŒå‚æ•°åŒ–é…ç½®
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### âœ… çµæ´»çš„ä»£ç åŠ è½½

- å†…è”ä»£ç : é€‚åˆç®€å•åŠ¨ç”»
- å¤–éƒ¨ URL: é€‚åˆå¤æ‚åŠ¨ç”»
- å…¨å±€å‡½æ•°: é€‚åˆé¡µé¢å†…å®šä¹‰

### âœ… è‡ªåŠ¨åŒ–ç®¡ç†

- è‡ªåŠ¨æŸ¥æ‰¾å®¹å™¨
- è‡ªåŠ¨åˆ›å»ºå®ä¾‹
- è‡ªåŠ¨æ³¨å†Œåˆ°å…¨å±€ä½œç”¨åŸŸ

### âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

- è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—
- å‹å¥½çš„é”™è¯¯æç¤º
- ä¼˜é›…çš„é™çº§å¤„ç†

### âœ… å“åº”å¼è®¾è®¡

- è‡ªåŠ¨é€‚åº”å®¹å™¨å®½åº¦
- æ”¯æŒçª—å£å¤§å°è°ƒæ•´
- ç§»åŠ¨ç«¯å‹å¥½

## ğŸ“š å‚è€ƒèµ„æº

- **å®Œæ•´æ–‡æ¡£**: `README-p5-system.md`
- **å¿«é€Ÿå‚è€ƒ**: `P5-QUICK-REFERENCE.md`
- **æµ‹è¯•é¡µé¢**: `test-p5-system.html`
- **ç¤ºä¾‹ä»£ç **: `sketches/remainder-sketch.js`
- **é…ç½®ç¤ºä¾‹**:
  - `config-with-p5-enhanced.json` (å†…è”)
  - `config-external-sketch.json` (å¤–éƒ¨)

## ğŸ” æŠ€æœ¯äº®ç‚¹

1. **åŠ¨æ€ä»£ç æ‰§è¡Œ**: ä½¿ç”¨ `Function` æ„é€ å™¨å®‰å…¨åœ°æ‰§è¡Œé…ç½®ä¸­çš„ä»£ç 
2. **å¼‚æ­¥åŠ è½½**: æ”¯æŒä»å¤–éƒ¨ URL å¼‚æ­¥åŠ è½½ sketch ä»£ç 
3. **å®ä¾‹ç®¡ç†**: è‡ªåŠ¨ç®¡ç† p5 å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸ
4. **é…ç½®æ˜ å°„**: ä½¿ç”¨ Map æ•°æ®ç»“æ„é«˜æ•ˆç®¡ç†é…ç½®
5. **å‚æ•°ä¼ é€’**: æ”¯æŒä»é…ç½®å‘ sketch ä¼ é€’ä»»æ„å‚æ•°

## ğŸ‰ æ€»ç»“

ç°åœ¨ä½ å¯ä»¥:

1. âœ… é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰ p5.js åŠ¨ç”»
2. âœ… ä½¿ç”¨ä¸‰ç§æ–¹å¼åŠ è½½åŠ¨ç”»ä»£ç 
3. âœ… ä¼ é€’å‚æ•°æ§åˆ¶åŠ¨ç”»è¡Œä¸º
4. âœ… åœ¨ä¸€ä¸ªé¡µé¢ä¸­ä½¿ç”¨å¤šä¸ªåŠ¨ç”»
5. âœ… è½»æ¾ç»´æŠ¤å’Œæ‰©å±•åŠ¨ç”»ç³»ç»Ÿ

å¼€å§‹åˆ›å»ºä½ çš„åŠ¨ç”»å§! ğŸš€
