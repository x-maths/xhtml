<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <style>
      *{margin:0;padding:0;box-sizing:border-box}
      html,body{width:100%;height:100%}
      body{display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;font-family:Arial, sans-serif}
      #app{width:100%;display:flex;justify-content:center;align-items:center}
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script src="https://cdn.jsdelivr.net/npm/konva@10.0.8/konva.min.js"></script>
    <script>
      (()=>{
        const C={maxW:900,pad:40,h:500,cOff:120,cY:80,cR:50,rectOff:220,rectY:320,rectW:180,rectH:100,dr:{x:60,y:60,r:25}};
        const w=()=>Math.min(window.innerWidth-C.pad,C.maxW);
        let stage,layer,circle,rect,dr;
        const clamp=()=>{const r=dr.radius();dr.x(Math.max(r,Math.min(dr.x(),stage.width()-r)));dr.y(Math.max(r,Math.min(dr.y(),stage.height()-r)))};
        const inCircle=()=>{const dx=dr.x()-circle.x(),dy=dr.y()-circle.y(),d=Math.hypot(dx,dy);return d+dr.radius()<=circle.radius()};
        const inRect=()=>{const x=dr.x(),y=dr.y(),r=dr.radius(),rx=rect.x(),ry=rect.y(),rw=rect.width(),rh=rect.height();return x-r>=rx&&x+r<=rx+rw&&y-r>=ry&&y+r<=ry+rh};
        const debounce=(f,ms=120)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>f(...a),ms)}};
        const init=()=>{
          stage=new Konva.Stage({container:'container',width:w(),height:C.h});layer=new Konva.Layer();stage.add(layer);
          circle=new Konva.Circle({x:w()-C.cOff,y:C.cY,radius:C.cR,fill:'#90EE90',stroke:'#4CAF50',strokeWidth:3,opacity:0.6});layer.add(circle);
          rect=new Konva.Rect({x:w()-C.rectOff,y:C.rectY,width:C.rectW,height:C.rectH,fill:'#ADD8E6',stroke:'#2196F3',strokeWidth:3,opacity:0.6});layer.add(rect);
          dr=new Konva.Circle({x:C.dr.x,y:C.dr.y,radius:C.dr.r,fill:'red',stroke:'black',strokeWidth:2,draggable:true});
          dr.dragBoundFunc(function(p){const r=this.radius();return{x:Math.max(r,Math.min(p.x,stage.width()-r)),y:Math.max(r,Math.min(p.y,stage.height()-r))}});
          dr.on('dragend',()=>{if(inCircle())dr.to({x:circle.x(),y:circle.y(),fill:'#4CAF50',duration:0.18});else if(inRect())dr.to({x:rect.x()+rect.width()/2,y:rect.y()+rect.height()/2,fill:'#2196F3',duration:0.18});else{dr.fill('red');layer.batchDraw()}setTimeout(()=>{clamp();layer.batchDraw()},200)});
          layer.add(dr);layer.draw();window.addEventListener('resize',debounce(()=>{stage.width(w());circle.x(w()-C.cOff);rect.x(w()-C.rectOff);clamp();layer.batchDraw()}));
        };
        window.addEventListener('DOMContentLoaded',init);
      })();
    </script>
  </body>
</html>
