<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H5æ•™å­¦ï¼šç®€ä¾¿è¿ç®—çš„é­”æ³•</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@2.1.1/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
    <style>
        /* ç¡®ä¿ p5 canvas å“åº”å¼ä¸”ä¸æº¢å‡º */
        .p5-container canvas {
            display: block;
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }
        /* Markdownè¡¨æ ¼çš„æ ·å¼å¢å¼º */
        .markdown-body table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        .markdown-body th, .markdown-body td {
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
            text-align: left;
        }
        .markdown-body th {
            background-color: #f3f4f6;
            font-weight: 600;
        }
        /* å¯¹è¯æ°”æ³¡æ ·å¼ */
        .chat-bubble {
            padding: 0.75rem 1.25rem;
            border-radius: 1.25rem;
            max-width: 85%;
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        .teacher-bubble {
            background-color: #d1fae5; /* ç»¿è‰²ç³» */
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .student-bubble {
            background-color: #e0f2fe; /* è“è‰²ç³» */
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 antialiased font-sans">

    <header class="bg-green-600 shadow-lg sticky top-0 z-10">
        <div class="max-w-4xl mx-auto p-4">
            <h1 class="text-3xl font-extrabold text-white tracking-tight">ç®€ä¾¿è¿ç®—çš„é­”æ³•ä¹‹æ—…</h1>
            <p class="text-green-200 mt-1">â€”â€” æé«˜è®¡ç®—æ•ˆç‡ä¸æ•°å­¦æ€ç»´çš„ç­–ç•¥</p>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8">

        <section id="knowledge-points" class="mb-10 bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-green-700 border-b pb-2">ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼šç®€ä¾¿è¿ç®—</h2>
            <article id="markdown-content" class="markdown-body text-gray-700 leading-relaxed"></article>
        </section>

        <section id="visualization-model" class="mb-10 p-6 bg-white rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-green-700 border-b pb-2">ğŸ§  ç­–ç•¥å¯è§†åŒ–ï¼šå‡‘æ•´ä¸åˆ†ç»„æ¼”ç¤º</h2>
            <p class="text-gray-600 mb-4">ç‚¹å‡»æˆ–æ‹–åŠ¨åœ†åœˆï¼Œè§‚å¯Ÿæ•°å­—å¦‚ä½•é€šè¿‡â€œå‡‘æ•´â€ç­–ç•¥è¿›è¡Œåˆ†ç»„å’Œç®€åŒ–ã€‚</p>
            <div id="p5-container" class="p5-container bg-gray-100 p-4 rounded-lg border border-gray-200" style="min-height: 300px;">
                </div>
        </section>

        <section id="teacher-student-dialogue" class="mb-10 p-6 bg-white rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold mb-6 text-green-700 border-b pb-2">ğŸ—£ï¸ è¯¾å ‚å®å½•ï¼šå¸ˆç”Ÿé—®ç­”ä¸ç‚¹æ‹¨</h2>
            <div id="dialogue-content" class="flex flex-col space-y-4">
                </div>
        </section>

    </main>

    <footer class="bg-gray-100 border-t mt-10">
        <div class="max-w-4xl mx-auto p-4 text-center text-gray-500 text-sm">
            <p>&copy; æ•™å­¦ç½‘é¡µç”Ÿæˆ | å†…å®¹å¿ å®å¤ç°è‡ªç”¨æˆ·è¾“å…¥ | H5å•é¡µå®è·µ</p>
        </div>
    </footer>

    <script>
        // I. çŸ¥è¯†ç‚¹å’Œå¯¹è¯å†…å®¹ (MUST be 100% faithful to user input)
        const knowledgeText = `
ç®€ä¾¿è¿ç®—æ˜¯æŒ‡åœ¨ä¸æ”¹å˜è¿ç®—ç»“æœçš„å‰æä¸‹ï¼Œé€šè¿‡é‡ç»„ã€æå–ã€å‡‘æ•´ç­‰æ–¹å¼ï¼Œä½¿è®¡ç®—è¿‡ç¨‹æ›´ç®€æ´ã€é«˜æ•ˆçš„è¿ç®—ç­–ç•¥ã€‚å®ƒæ˜¯å°å­¦æ•°å­¦ä¸­è®¡ç®—èƒ½åŠ›å’Œæ•°å­¦æ€ç»´çµæ´»æ€§çš„æ ¸å¿ƒä½“ç°ã€‚

| ç­–ç•¥åç§°      | å«ä¹‰è¯´æ˜                       | ç¤ºä¾‹                                                   |
| --------- | -------------------------- | ---------------------------------------------------- |
| **å‡‘å/å‡‘ç™¾** | æŠŠæ•°å‡‘æˆ10ã€100ã€1000ç­‰æ•´åæ•´ç™¾æ•°ï¼Œç®€åŒ–è®¡ç®— | 8 + 5 + 2 = (8 + 2) + 5 = 10 + 5 = 15                |
| **åˆ†ç»„** | æŠŠèƒ½å‡‘æ•´æˆ–å¥½ç®—çš„æ•°å…ˆç®—ï¼Œå‡å°‘æ­¥éª¤           | 27 + 48 + 3 + 2 = (27 + 3) + (48 + 2) = 30 + 50 = 80 |
| **æå–å…¬å› æ•°** | å¤šä¸ªä¹˜æ³•ç®—å¼ä¸­æœ‰ç›¸åŒå› æ•°æ—¶ï¼Œæå–å‡ºæ¥         | 25Ã—3 + 25Ã—7 = 25Ã—(3+7) = 25Ã—10 = 250                 |
| **è¿ç”¨ç»“åˆå¾‹** | æ”¹å˜è¿ç®—é¡ºåºä½†ä¸æ”¹å˜ç»“æœ               | (12 + 8) + 5 = 12 + (8 + 5) = 25                     |
| **è¿ç”¨äº¤æ¢å¾‹** | æ”¹å˜æ•°çš„ä½ç½®ä½†ä¸æ”¹å˜ç»“æœ               | 17 + 36 + 83 = 17 + 83 + 36 = 100 + 36 = 136         |

ä¾‹é¢˜1ï¼šå‡‘æ•´æ³•
è®¡ç®—ï¼š98 + 37
è§£æï¼š
æŠŠ98å‡‘æˆ100ï¼Œå¤šåŠ äº†2ï¼Œåé¢è¦å‡å»2
98 + 37 = (98 + 2) + (37 - 2) = 100 + 35 = 135

ä¾‹é¢˜2ï¼šåˆ†ç»„å‡‘æ•´
è®¡ç®—ï¼š27 + 48 + 3 + 2
è§£æï¼š
æŠŠèƒ½å‡‘æ•´çš„æ•°å…ˆåˆ†ç»„
(27 + 3) + (48 + 2) = 30 + 50 = 80

ä¾‹é¢˜3ï¼šæå–å…¬å› æ•°
è®¡ç®—ï¼š25Ã—3 + 25Ã—7
è§£æï¼š
æå–å…¬å› æ•°25
25Ã—(3 + 7) = 25Ã—10 = 250

ä¾‹é¢˜4ï¼šç»“åˆå¾‹ä¸äº¤æ¢å¾‹
è®¡ç®—ï¼š17 + 36 + 83
è§£æï¼š
å…ˆäº¤æ¢ä½ç½®ï¼Œå†ç»“åˆ
17 + 83 + 36 = 100 + 36 = 136

æ•™å­¦å»ºè®®ä¸æ€ç»´ç‚¹æ‹¨

| æ•™å­¦ç‚¹      | å»ºè®®                |
| -------- | ----------------- |
| **è§‚å¯ŸåŠ›** | å…ˆè§‚å¯Ÿæœ‰æ²¡æœ‰â€œæ•´åæ•´ç™¾â€å¯å‡‘    |
| **ç»“æ„æ„Ÿ** | è¯†åˆ«â€œç›¸åŒå› æ•°â€æˆ–â€œå¯äº¤æ¢â€ç»“æ„  |
| **ä¹¦å†™ä¹ æƒ¯** | ç”¨æ‹¬å·æ ‡æ³¨é‡ç»„è¿‡ç¨‹ï¼ŒåŸ¹å…»æ¡ç†    |
| **å£è¯€è®°å¿†** | â€œå…ˆå‡‘æ•´ï¼Œå†åˆ†ç»„ï¼Œå…¬å› æ•°ï¼Œæå¹²å‡€â€ |

äº”ã€æ€»ç»“å£è¯€ï¼ˆé€‚åˆèƒŒè¯µï¼‰
â€œç®€ä¾¿è¿ç®—ä¸ç¥ç§˜ï¼Œå‡‘æ•´åˆ†ç»„æ˜¯ç‹é“ï¼›
å…¬å› æ•°ï¼Œæå¹²å‡€ï¼Œç»“åˆäº¤æ¢çµæ´»ç”¨ï¼›
ä¸€çœ‹äºŒæƒ³ä¸‰åŠ¨æ‰‹ï¼Œåˆå¿«åˆå‡†ä¸çŠ¯é”™ï¼â€
`;

        const dialogueText = `
è€å¸ˆï¼šåŒå­¦ä»¬ï¼Œä½ ä»¬å–œæ¬¢ç©é­”æœ¯å—ï¼Ÿæ•°å­¦é‡Œä¹Ÿæœ‰ä¸€äº›å°é­”æœ¯ï¼Œèƒ½è®©æˆ‘ä»¬çš„è®¡ç®—å˜å¾—åˆå¿«åˆå‡†ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥å­¦ä¹ â€œç®€ä¾¿è¿ç®—â€è¿™ä¸ªé­”æ³•ã€‚
å­¦ç”Ÿï¼šå“‡ï¼Œæ•°å­¦é­”æœ¯ï¼æ˜¯ä»€ä¹ˆå‘€ï¼Ÿ
è€å¸ˆï¼šâ€œç®€ä¾¿è¿ç®—â€å‘€ï¼Œå°±æ˜¯å½“æˆ‘ä»¬æœ‰å¾ˆå¤šæ•°å­—è¦åŠ å‡ä¹˜é™¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æ”¹å˜å®ƒä»¬æœ€åçš„ç»“æœï¼Œä½†æ˜¯é€šè¿‡ä¸€äº›å°çªé—¨ï¼Œè®©è®¡ç®—è¿‡ç¨‹å˜å¾—æ›´å®¹æ˜“ï¼Œä¹Ÿæ›´å¿«ã€‚å°±åƒèµ°ä¸€æ¡æ›´è¿‘çš„è·¯ä¸€æ ·ã€‚
å­¦ç”Ÿï¼šå“¦ï¼Œå°±æ˜¯æ‰¾ä¸€æ¡è¿‘è·¯ç®—é¢˜å—ï¼Ÿ
è€å¸ˆï¼šå¯¹ï¼é‚£æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªå°çªé—¨ï¼Œå«åšâ€œå‡‘åå‡‘ç™¾â€ã€‚ä½ è§‰å¾—â€œå‡‘åâ€æ˜¯ä»€ä¹ˆæ„æ€å‘€ï¼Ÿ
å­¦ç”Ÿï¼šå—¯â€¦â€¦æ˜¯ä¸æ˜¯æŠŠæ•°å­—åŠ èµ·æ¥å˜æˆåï¼Ÿ
è€å¸ˆï¼šçœŸèªæ˜ï¼å°±æ˜¯æŠŠèƒ½åŠ èµ·æ¥å˜æˆåã€å˜æˆä¸€ç™¾ã€ç”šè‡³å˜æˆä¸€åƒçš„æ•°ï¼Œå…ˆç®—åœ¨ä¸€èµ·ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è¦ç®—å…«åŠ äº”åŠ äºŒï¼Œä½ ä¼šæ€ä¹ˆç®—å‘¢ï¼Ÿ
å­¦ç”Ÿï¼šå…«åŠ äº”ç­‰äºåä¸‰ï¼Œåä¸‰åŠ äºŒç­‰äºåäº”ã€‚
è€å¸ˆï¼šç®—å¾—æ²¡é”™ï¼ä½†æ˜¯æˆ‘ä»¬è¯•è¯•å‡‘åã€‚å…«å’ŒäºŒåŠ èµ·æ¥æ˜¯å¤šå°‘å‘€ï¼Ÿ
å­¦ç”Ÿï¼šå…«åŠ äºŒç­‰äºåï¼
è€å¸ˆï¼šå¯¹å•¦ï¼Œé‚£åå†åŠ äº”å‘¢ï¼Ÿ
å­¦ç”Ÿï¼šç­‰äºåäº”ï¼å“‡ï¼Œè¿™æ ·ç®—çœŸçš„å¿«ï¼
è€å¸ˆï¼šè¿™å°±æ˜¯â€œå‡‘åâ€çš„é­”åŠ›ã€‚å†æ¥çœ‹ä¸€ä¸ªï¼Œå¦‚æœæˆ‘ä»¬è¦ç®—äºŒåä¸ƒåŠ å››åå…«åŠ ä¸‰åŠ äºŒå‘¢ï¼Ÿ
å­¦ç”Ÿï¼šå¥½å¤šæ•°å­—ï¼
è€å¸ˆï¼šåˆ«æ€•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨â€œåˆ†ç»„â€çš„æ–¹æ³•ã€‚æ‰¾æ‰¾çœ‹ï¼Œå“ªäº›æ•°å­—åŠ èµ·æ¥èƒ½å‡‘æˆåæˆ–è€…æ•´åçš„æ•°å‘€ï¼Ÿ
å­¦ç”Ÿï¼šæˆ‘çœ‹åˆ°äºŒåä¸ƒå’Œä¸‰å¯ä»¥å‡‘æˆä¸‰åï¼å››åå…«å’ŒäºŒå¯ä»¥å‡‘æˆäº”åï¼
è€å¸ˆï¼šå¤ªæ£’äº†ï¼é‚£å°±æ˜¯æŠŠèƒ½å‡‘æ•´çš„æ•°å­—å…ˆç”¨å°æ‹¬å·æ‹¬èµ·æ¥ï¼Œåƒï¼ˆäºŒåä¸ƒåŠ ä¸‰ï¼‰å†åŠ ä¸Šï¼ˆå››åå…«åŠ äºŒï¼‰ï¼Œå°±ç­‰äºä¸‰ååŠ äº”åï¼Œæœ€åæ˜¯å¤šå°‘å‘€ï¼Ÿ
å­¦ç”Ÿï¼šä¸‰ååŠ äº”åç­‰äºå…«åï¼è¿™æ ·ç®—çœŸæ–¹ä¾¿ï¼
è€å¸ˆï¼šå¦‚æœä½ å’Œçˆ¸çˆ¸å¦ˆå¦ˆå»è¶…å¸‚ä¹°ä¸œè¥¿ï¼Œå¦ˆå¦ˆè®©ä½ ç®—ä¸€ä¸‹ï¼Œå¥¹ä¹°äº†ä¸€ç›’äºŒåäº”å…ƒçš„é¥¼å¹²ï¼Œåˆä¹°äº†ä¸€ç›’äºŒåäº”å…ƒçš„ç‰›å¥¶ï¼Œè¿˜æœ‰ä¸€ç›’ä¸ƒå…ƒçš„å·§å…‹åŠ›ï¼Œå’Œä¸€ç›’ä¸‰å…ƒçš„ç³–æœã€‚æ€»å…±èŠ±äº†å¤šå°‘é’±ï¼Ÿä½ ä¼šæ€ä¹ˆç®—å‘¢ï¼Ÿ
å­¦ç”Ÿï¼šå—¯â€¦â€¦äºŒåäº”åŠ äºŒåäº”åŠ ä¸ƒåŠ ä¸‰ï¼Ÿ
è€å¸ˆï¼šå¯¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç®—ï¼šäºŒåäº”åŠ äºŒåäº”æ˜¯å¤šå°‘ï¼Ÿ
å­¦ç”Ÿï¼šäº”åï¼
è€å¸ˆï¼šä¸ƒåŠ ä¸‰æ˜¯å¤šå°‘ï¼Ÿ
å­¦ç”Ÿï¼šåï¼
è€å¸ˆï¼šæ‰€ä»¥æ€»å…±å°±æ˜¯äº”ååŠ åï¼Œç­‰äºå¤šå°‘å‘¢ï¼Ÿ
å­¦ç”Ÿï¼šå…­åå…ƒï¼å™¢ï¼Œæˆ‘æ˜ç™½äº†ï¼æŠŠä¸ƒå…ƒå’Œä¸‰å…ƒå…ˆåŠ èµ·æ¥ï¼Œå› ä¸ºå®ƒä¿©æ­£å¥½æ˜¯åå…ƒï¼
è€å¸ˆï¼šä½ è¯´çš„æ²¡é”™ï¼è¿™å°±æ˜¯â€œå‡‘æ•´â€çš„åŠæ³•ã€‚æˆ‘ä»¬åœ¨ä¹°ä¸œè¥¿çš„æ—¶å€™ï¼Œå¸¸å¸¸ä¼šç”¨åˆ°è¿™æ ·çš„ç®€ä¾¿è¿ç®—å‘¢ã€‚é™¤äº†å‡‘åå‡‘ç™¾ï¼Œæˆ‘ä»¬è¿˜æœ‰â€œäº¤æ¢å¥½æœ‹å‹â€å’Œâ€œç»“åˆå¥½ä¼™ä¼´â€ã€‚â€œäº¤æ¢å¥½æœ‹å‹â€å°±æ˜¯ï¼Œå¦‚æœå‡ ä¸ªæ•°ç›¸åŠ ï¼Œæ”¹å˜å®ƒä»¬çš„ä½ç½®ï¼Œç»“æœä¼šä¸ä¼šå˜å‘¢ï¼Ÿæ¯”å¦‚ï¼Œä¸‰åŠ äº”ç­‰äºå¤šå°‘ï¼Ÿ
å­¦ç”Ÿï¼šå…«ï¼
è€å¸ˆï¼šé‚£äº”åŠ ä¸‰å‘¢ï¼Ÿ
å­¦ç”Ÿï¼šè¿˜æ˜¯å…«ï¼
è€å¸ˆï¼šå¯¹ï¼Œè¿™å°±æ˜¯â€œäº¤æ¢å¾‹â€ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ•°å­—äº¤æ¢ä½ç½®ï¼Œè®©èƒ½å‡‘æ•´çš„æ•°å­—æŒ¨åœ¨ä¸€èµ·ã€‚æ¯”å¦‚ï¼Œåä¸ƒåŠ ä¸‰åå…­åŠ å…«åä¸‰ï¼Œä½ ä¼šæ€ä¹ˆè®©å®ƒç®—å¾—æ›´å¿«ï¼Ÿ
å­¦ç”Ÿï¼šå—¯â€¦â€¦åä¸ƒå’Œå…«åä¸‰å¯ä»¥å‡‘æˆä¸€ç™¾ï¼
è€å¸ˆï¼šå®Œå…¨æ­£ç¡®ï¼æˆ‘ä»¬å°±å¯ä»¥æŠŠå…«åä¸‰å’Œä¸‰åå…­äº¤æ¢ä¸€ä¸‹ä½ç½®ï¼Œå˜æˆåä¸ƒåŠ å…«åä¸‰åŠ ä¸‰åå…­ã€‚è¿™æ ·ï¼Œå…ˆç®—åä¸ƒåŠ å…«åä¸‰ç­‰äºä¸€ç™¾ï¼Œä¸€ç™¾å†åŠ ä¸‰åå…­ï¼Œå°±ç­‰äºä¸€ç™¾ä¸‰åå…­äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ
å­¦ç”Ÿï¼šæ˜¯è€¶ï¼æˆ‘å–œæ¬¢è®©å¥½æœ‹å‹å…ˆè§é¢ï¼
è€å¸ˆï¼šé‚£â€œç»“åˆå¥½ä¼™ä¼´â€å‘¢ï¼Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰å¾ˆå¤šæ•°ç›¸åŠ ï¼Œæˆ‘ä»¬ç”¨å°æ‹¬å·æŠŠå…ˆç®—çš„æ•°æ‹¬èµ·æ¥ï¼Œæ”¹å˜ä¸€ä¸‹å°æ‹¬å·çš„ä½ç½®ï¼Œç»“æœä¹Ÿæ˜¯ä¸å˜çš„ã€‚å°±åƒï¼ˆåäºŒåŠ å…«ï¼‰å†åŠ äº”ï¼Œå’ŒåäºŒåŠ ï¼ˆå…«åŠ äº”ï¼‰ï¼Œç»“æœéƒ½æ˜¯äºŒåäº”ã€‚è¿™å«ç»“åˆå¾‹ã€‚
å­¦ç”Ÿï¼šå“¦ï¼Œå°±åƒç©æ¸¸æˆï¼Œå…ˆè·Ÿè¿™ä¸ªæœ‹å‹ç©ï¼Œå†è·Ÿé‚£ä¸ªæœ‹å‹ç©ï¼Œæœ€åç»“æœæ˜¯ä¸€æ ·çš„ï¼
è€å¸ˆï¼šæœ€åä¸€ä¸ªå°é­”æœ¯ï¼Œå«åšâ€œæå–å…¬å› æ•°â€ã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¼šé‡åˆ°è¿™æ ·çš„ç®—å¼ï¼šäºŒåäº”ä¹˜ä¸‰ï¼ŒåŠ ä¸ŠäºŒåäº”ä¹˜ä¸ƒã€‚ä½ çœ‹ï¼Œè¿™é‡Œé¢å“ªä¸ªæ•°å­—æ˜¯é‡å¤å‡ºç°çš„ï¼Ÿ
å­¦ç”Ÿï¼šæ˜¯äºŒåäº”ï¼
è€å¸ˆï¼šå¯¹ï¼äºŒåäº”å°±æ˜¯å®ƒä»¬çš„â€œå…¬å› æ•°â€ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒâ€œæå–â€å‡ºæ¥ï¼Œæ”¾åˆ°å°æ‹¬å·å¤–é¢ï¼Œç„¶åå°æ‹¬å·é‡Œé¢å†™ä¸Šå‰©ä¸‹çš„ä¸‰åŠ ä¸ƒã€‚å°±åƒè¿™æ ·ï¼šäºŒåäº”ä¹˜ï¼ˆä¸‰åŠ ä¸ƒï¼‰ã€‚ä¸‰åŠ ä¸ƒæ˜¯å¤šå°‘å‘€ï¼Ÿ
å­¦ç”Ÿï¼šä¸‰åŠ ä¸ƒç­‰äºåï¼
è€å¸ˆï¼šé‚£äºŒåäº”ä¹˜åå‘¢ï¼Ÿ
å­¦ç”Ÿï¼šäºŒåäº”ä¹˜åç­‰äºäºŒç™¾äº”åï¼å“‡ï¼Œè¿™ä¸ªä¹Ÿå¾ˆå¿«ï¼
è€å¸ˆï¼šä½ çœ‹ï¼Œå¦‚æœæŒ‰ç…§é¡ºåºç®—ï¼ŒäºŒåäº”ä¹˜ä¸‰æ˜¯ä¸ƒåäº”ï¼ŒäºŒåäº”ä¹˜ä¸ƒæ˜¯ä¸€ç™¾ä¸ƒåäº”ï¼Œä¸ƒåäº”åŠ ä¸€ç™¾ä¸ƒåäº”æ˜¯äºŒç™¾äº”åã€‚è™½ç„¶ç»“æœä¸€æ ·ï¼Œä½†æå–å…¬å› æ•°æ˜¯ä¸æ˜¯æ›´å¿«ä¸€äº›ï¼Ÿ
å­¦ç”Ÿï¼šæ˜¯ï¼è¿™ä¸ªä¹Ÿå¾ˆç¥å¥‡ï¼
è€å¸ˆï¼šåŒå­¦ä»¬ï¼Œä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº†ç®€ä¾¿è¿ç®—ã€‚å®ƒèƒ½è®©æˆ‘ä»¬çš„è®¡ç®—å˜å¾—æ›´ç®€å•ã€æ›´å¿«é€Ÿã€‚æˆ‘ä»¬è¦å­¦ä¼šè§‚å¯Ÿé¢˜ç›®ï¼Œæ‰¾åˆ°èƒ½å‡‘æ•´çš„æ•°å­—ï¼Œæˆ–è€…å¯ä»¥äº¤æ¢ä½ç½®çš„æ•°å­—ï¼Œè¿™æ ·å°±èƒ½åˆå¿«åˆå‡†ç¡®åœ°ç®—å‡ºç»“æœå•¦ï¼
è€å¸ˆï¼šå¥½äº†ï¼Œè€å¸ˆç»™ä½ ç•™ä¸€ä¸ªå°å°çš„æŒ‘æˆ˜ï¼šè¯·ä½ ç”¨ç®€ä¾¿è¿ç®—çš„æ–¹æ³•ï¼Œç®—ä¸€ç®—ä¸‹é¢è¿™é“é¢˜ï¼šå››åä¹åŠ äºŒåäº”åŠ ä¸ƒåäº”åŠ ä¸€ã€‚
`;

        // II. Markdown Rendering
        document.addEventListener('DOMContentLoaded', () => {
            const md = window.markdownit();
            const result = md.render(knowledgeText);
            document.getElementById('markdown-content').innerHTML = result;
            renderDialogue();
        });

        // III. Dialogue Rendering
        function renderDialogue() {
            const dialogueContainer = document.getElementById('dialogue-content');
            const lines = dialogueText.trim().split('\n').filter(line => line.trim() !== '');

            lines.forEach(line => {
                let speaker = '';
                let content = line;
                let isTeacher = false;
                let bubbleClass = 'teacher-bubble self-start';
                let speakerTag = 'è€å¸ˆ';

                if (line.startsWith('è€å¸ˆï¼š')) {
                    speaker = 'è€å¸ˆ';
                    content = line.substring(3).trim();
                    isTeacher = true;
                } else if (line.startsWith('å­¦ç”Ÿï¼š')) {
                    speaker = 'å­¦ç”Ÿ';
                    content = line.substring(3).trim();
                    bubbleClass = 'student-bubble self-end';
                    speakerTag = 'å­¦ç”Ÿ';
                }

                if (speaker) {
                    const bubble = document.createElement('div');
                    bubble.className = `chat-bubble ${bubbleClass} text-sm md:text-base`;
                    bubble.innerHTML = `<span class="font-bold mr-2 ${isTeacher ? 'text-green-800' : 'text-blue-800'}">${speakerTag}:</span> ${content}`;
                    dialogueContainer.appendChild(bubble);
                }
            });
        }

        // IV. p5.js Visualization Model: Simulating Grouping and Swapping
        let sketch = function(p) {
            let particles = [];
            const numbers = [17, 36, 83]; // å¯¹åº” 17 + 36 + 83 = 136 çš„ä¾‹å­
            const colors = ['#f87171', '#fbbf24', '#34d399']; // çº¢è‰², é»„è‰², ç»¿è‰²
            const targetY = 150; // ç›®æ ‡Yè½´ä½ç½®
            const targetX = [p.width * 0.25, p.width * 0.5, p.width * 0.75]; // åˆå§‹ä½ç½®X
            const finalX = [p.width * 0.2, p.width * 0.4, p.width * 0.6, p.width * 0.8]; // æœ€ç»ˆåˆ†ç»„ä½ç½®X
            let stage = 0; // 0: åˆå§‹, 1: äº¤æ¢ä¸­, 2: äº¤æ¢å®Œæˆ, 3: åˆ†ç»„é«˜äº®
            let swapTime = 0;

            class Particle {
                constructor(num, color, initialX, initialY, index) {
                    this.num = num;
                    this.color = color;
                    this.r = 30;
                    this.x = initialX;
                    this.y = initialY;
                    this.vx = 0;
                    this.vy = 0;
                    this.targetX = initialX;
                    this.targetY = targetY;
                    this.index = index;
                    this.isHighlighted = false;
                }

                update() {
                    let dx = this.targetX - this.x;
                    let dy = this.targetY - this.y;
                    this.vx = dx * 0.1;
                    this.vy = dy * 0.1;
                    this.x += this.vx;
                    this.y += this.vy;
                }

                display() {
                    p.noStroke();
                    p.fill(this.color + 'aa'); // åŠé€æ˜
                    if (this.isHighlighted) {
                        p.fill(this.color); // å®è‰²é«˜äº®
                        p.stroke(255, 255, 0); // é»„è‰²è¾¹æ¡†
                        p.strokeWeight(3);
                    }
                    p.ellipse(this.x, this.y, this.r * 2);

                    p.fill(255);
                    p.textAlign(p.CENTER, p.CENTER);
                    p.textSize(16);
                    p.text(this.num, this.x, this.y);

                    if (stage >= 2 && (this.num === 17 || this.num === 83)) {
                         p.stroke(255, 165, 0, 150); // æ©˜è‰²è™šçº¿
                         p.strokeWeight(5);
                         p.line(this.x + this.r, this.y, particles.find(pt => pt.num === (this.num === 17 ? 83 : 17)).x - this.r, this.y);
                    }
                }
                
                // å¤–éƒ¨è°ƒç”¨è®¾ç½®ç›®æ ‡ä½ç½®
                setTarget(tx, ty) {
                    this.targetX = tx;
                    this.targetY = ty;
                }
            }

            p.setup = function() {
                let canvas = p.createCanvas(document.getElementById('p5-container').offsetWidth, 300);
                canvas.mousePressed(p.mouseClicked);

                // åˆå§‹åŒ–ç²’å­
                particles.push(new Particle(numbers[0], colors[0], p.width * 0.2, targetY, 0));
                particles.push(new Particle(numbers[1], colors[1], p.width * 0.4, targetY, 1));
                particles.push(new Particle(numbers[2], colors[2], p.width * 0.6, targetY, 2));

                p.textAlign(p.CENTER, p.TOP);
                p.textSize(20);
                p.textStyle(p.BOLD);
            };

            p.draw = function() {
                p.background(249, 250, 251); // bg-gray-50
                p.fill(55, 65, 81); // text-gray-700

                // ç»˜åˆ¶å½“å‰è¡¨è¾¾å¼
                let expression = '';
                if (stage === 0) {
                     expression = 'åˆå§‹é¡ºåº: 17 + 36 + 83';
                } else if (stage === 1) {
                     expression = 'ç­–ç•¥ï¼šäº¤æ¢ 36 å’Œ 83 çš„ä½ç½® (äº¤æ¢å¾‹)';
                } else if (stage >= 2) {
                     expression = 'ç®€ä¾¿è®¡ç®—: (17 + 83) + 36 = 100 + 36 = 136';
                }
                p.text(expression, p.width / 2, 20);

                // æ›´æ–°å’Œæ˜¾ç¤ºç²’å­
                particles.forEach(pt => {
                    pt.update();
                    pt.display();
                });
                
                // é˜¶æ®µæ§åˆ¶
                if (stage === 1) {
                    swapTime++;
                    if (swapTime > 60) { // å»¶è¿Ÿä¸€å°æ®µæ—¶é—´å¼€å§‹äº¤æ¢
                        // 17 & 83 äº’æ¢ä½ç½® (æ¨¡æ‹Ÿäº¤æ¢å¾‹)
                        const p17 = particles.find(pt => pt.num === 17);
                        const p36 = particles.find(pt => pt.num === 36);
                        const p83 = particles.find(pt => pt.num === 83);
                        
                        // 17 stay, 36 to 83's old spot, 83 to 36's old spot
                        p17.setTarget(p.width * 0.2, targetY);
                        p36.setTarget(p.width * 0.6, targetY);
                        p83.setTarget(p.width * 0.4, targetY);
                        
                        stage = 2; // è¿›å…¥äº¤æ¢åé˜¶æ®µ
                        swapTime = 0; // é‡ç½®è®¡æ—¶
                    }
                } else if (stage === 2) {
                    let done = particles.every(pt => p.dist(pt.x, pt.y, pt.targetX, pt.targetY) < 5);
                    if (done) {
                        particles.forEach(pt => {
                            if (pt.num === 17 || pt.num === 83) {
                                pt.isHighlighted = true;
                            }
                        });
                        stage = 3;
                    }
                }
            };
            
            p.mouseClicked = function() {
                // ç‚¹å‡»åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªç­–ç•¥å±•ç¤º
                if (stage === 0) {
                    stage = 1; // è§¦å‘äº¤æ¢
                } else if (stage === 3) {
                    // é‡ç½®
                    particles = [];
                    particles.push(new Particle(numbers[0], colors[0], p.width * 0.2, targetY, 0));
                    particles.push(new Particle(numbers[1], colors[1], p.width * 0.4, targetY, 1));
                    particles.push(new Particle(numbers[2], colors[2], p.width * 0.6, targetY, 2));
                    stage = 0;
                    particles.forEach(pt => pt.isHighlighted = false);
                }
            }

            p.windowResized = function() {
                // å“åº”å¼è°ƒæ•´
                p.resizeCanvas(document.getElementById('p5-container').offsetWidth, 300);
                p.setup(); // é‡æ–°è®¾ç½®ä½ç½®
            }
        };

        // ç»‘å®š p5 å®ä¾‹åˆ°å®¹å™¨
        new p5(sketch, 'p5-container');
    </script>
</body>
</html>